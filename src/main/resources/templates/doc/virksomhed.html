<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout">
<head>
    <title>Virksomheder</title>
</head>
<body>
<div layout:fragment="content">


    <h3>Interaktiv Virksomhedssøgning</h3>
    <p>Søg efter virksomheder ved at udfylde et eller flere af de nedenstående felter. Se beskrivelsen af parametrene <a href="#parameters">længere nede på siden.</a></p>

    <div class="search">

        <div class="form-group col-sm-12">
            <label for="virksomhed" class="col-sm-2 control-label">Virksomhedsnavn:</label>
            <div class="col-sm-3">
                <input type="text" name="virksomhed" id="virksomhed" class="form-control"/>
            </div>
        </div>

        <div class="form-group col-sm-12">
            <label for="cvr" class="col-sm-2 control-label">CVR-nummer:</label>
            <div class="col-sm-3">
                <input type="text" name="cvr" id="cvr" class="form-control"/>
            </div>
        </div>

        <div class="form-group col-sm-12">
            <label for="land" class="col-sm-2 control-label">Land:</label>
            <div class="col-sm-3">
                <select name="land" id="land" class="form-control">
                        <option value="">-</option>
                        <option value="dk">Danmark</option>
                        <option value="gl">Grønland</option>
                    </select>
            </div>
        </div>

        <div class="form-group col-sm-12">
            <label for="kommune" class="col-sm-2 control-label">Kommune:</label>
            <div class="col-sm-3">
                <input type="text" name="kommune" id="kommune" class="form-control"/>
            </div>
        </div>

        <div class="form-group col-sm-12">
            <label for="post" class="col-sm-2 control-label">Post:</label>
            <div class="col-sm-3">
                <input type="text" name="post" id="post" class="form-control"/>
            </div>
        </div>

        <div class="form-group col-sm-12">
            <label for="vej" class="col-sm-2 control-label">Vej:</label>
            <div class="col-sm-3">
                <input type="text" name="vej" id="vej" class="form-control"/>
            </div>
        </div>

        <div class="form-group col-sm-12">
            <label for="husnr" class="col-sm-2 control-label">Husnr:</label>
            <div class="col-sm-3">
                <input type="text" name="husnr" id="husnr" class="form-control"/>
            </div>
        </div>

        <div class="form-group col-sm-12">
            <label for="bnr" class="col-sm-2 control-label">B-nummer:</label>
            <div class="col-sm-3">
                <input type="text" name="bnr" id="bnr" class="form-control"/>
            </div>
        </div>

        <div class="form-group col-sm-12">
            <label for="etage" class="col-sm-2 control-label">Etage:</label>
            <div class="col-sm-3">
                <input type="text" name="etage" id="etage" class="form-control"/>
            </div>
        </div>

        <div class="form-group col-sm-12">
            <label for="doer" class="col-sm-2 control-label">Dør:</label>
            <div class="col-sm-3">
                <input type="text" name="doer" id="doer" class="form-control"/>
            </div>
        </div>

        <div class="form-group col-sm-12">
            <label for="includeBefore" class="col-sm-2 control-label">IncludeBefore:</label>
            <div class="col-sm-3">
                <input type="date" name="includeBefore" id="includeBefore" class="form-control"/>
            </div>
        </div>

        <div class="form-group col-sm-12">
            <label for="IncludeAfter" class="col-sm-2 control-label">IncludeAfter:</label>
            <div class="col-sm-3">
                <input type="date" name="IncludeAfter" id="IncludeAfter" class="form-control"/>
            </div>
        </div>


        <button type="submit" id="json" name="format" value="json" onclick="" class="btn btn-default">JSON</button>
        <button type="submit" id="xml" name="format" value="xml" onclick="" class="btn btn-default">XML</button>
        <button type="submit" id="tree" name="format" value="tree" onclick="" class="btn btn-default">Tree</button>
        <img id="loading" th:src="@{/img/loading.gif}" style="display:none"/>
        <textarea class="output" id="results" readonly="readonly"/>
        <div id="treeview"/>
    </div>
    <script type="text/javascript" th:inline="javascript">
        //<![CDATA[
        var fields = $('#virksomhed,#cvr,#land,#kommune,#post,#vej,#husnr,#bnr,#etage,#doer,#includeBefore,#includeAfter');
        var currentFormat = $("#json");

        var showData = function(data) {
            $("#treeview").hide();
            $("#results").text(data);
            $("#results").show();
        }
        var showTree = function(data) {
            $("#results").hide();
            $("#treeview").magentaTree(data);
            $("#treeview").show();
        }


        $("#json,#xml").each(function(i,el){
            var button = $(el);

            var run = doSearch.bind(
                null,
                /*[[@{/services/search/virksomhed}]]*/ '/services/search/virksomhed',
                fields.add(button),
                function(data) {
                    showData(data);
                    currentFormat = button;
                },
                $("#loading")
            );
            button.select(run);
            button.click(run);
        });

        $("#tree").click(doSearch.bind(
            null,
            /*[[@{/services/search/virksomhed}]]*/ '/services/search/virksomhed',
            fields.add("#json"),
            function(data) {
                showTree(data);
                currentFormat = "tree";
            },
            $("#loading")
        ));

         fields.keyup(function(ev){
             if (ev.keyCode == 13) {
                 doSearch(
                     /*[[@{/services/search/virksomhed}]]*/ '/services/search/virksomhed',
                     fields.add(currentFormat == "tree" ? $("#json") : currentFormat),
                     function(data) {
                         if (currentFormat == "tree") {
                             showTree(data);
                         } else {
                             showData(data);
                         }
                     },
                     $("#loading")
                 )
             }
         })

        //]]>
    </script>

    <hr/>

    <h3>Virksomhedsopslag</h3>
    <p>Find virksomhed ud fra cvrnummer</p>
    <pre th:text="|GET | + @{/service/search/virksomhed/{cvr}}"></pre>

    <h4>Parametre</h4>
    <table class="table table-hover">
        <thead>
        <tr>
            <th>Navn</th>
            <th>Beskrivelse</th>
        </tr>
        </thead>
        <tbody>

        <tr>
            <td>id</td>
            <td>
                Viksomhedens cvr-nummer. Denne er unik, tildelt af systemet, og modtages i data ved søgning.
            </td>
        </tr>

        </tbody>
    </table>

    <h4>Eksempler</h4>

    <p th:text="'Hent virksomhed ud fra cvrnummer ' + ${cvr}"></p>
    <a th:href="@{/services/search/virksomhed/{cvr}(cvr=${cvr})}"><pre th:text="'/services/search/virksomhed/' + ${cvr}"></pre></a>

    <div class="page-header"/>

    <h3>Virksomhedssøgning</h3>
    <p>Søg efter virksomheder, afgrænset af angivne parametre</p>
    <pre th:text="|GET | + @{/service/search/virksomhed}"></pre>
    <a name="parameters"></a>
    <h4>Parametre</h4>
    <table class="table table-hover">
        <thead>
        <tr>
            <th>Navn</th>
            <th>Beskrivelse</th>
        </tr>
        </thead>
        <tbody>

        <tr th:replace="doc/fragments/params/virksomhed"/>
        <tr th:replace="doc/fragments/params/cvr"/>

        <tr th:replace="doc/fragments/params/kommune"/>
        <tr th:replace="doc/fragments/params/land"/>
        <tr th:replace="doc/fragments/params/vej"/>
        <tr th:replace="doc/fragments/params/post"/>
        <tr th:replace="doc/fragments/params/husnr"/>
        <tr th:replace="doc/fragments/params/bnr"/>
        <tr th:replace="doc/fragments/params/etage"/>
        <tr th:replace="doc/fragments/params/doer"/>

        <tr th:replace="doc/fragments/params/format"/>
        <tr th:replace="doc/fragments/params/includeBefore"/>
        <tr th:replace="doc/fragments/params/includeAfter"/>

        </tbody>
    </table>

    <h4>Eksempler</h4>

    <p>Find alle virksomheder i Grønland, og output data i xml-format</p>
    <a th:href="@{/services/search/virksomhed?land=gl&amp;format=xml}"><pre>/services/search/virksomhed?land=gl&amp;format=xml</pre></a>

    <p>Find alle virksomhed hvis navn begynder med A</p>
    <a th:href="@{/services/search/virksomhed?virksomhed=A*}"><pre>/services/search/virksomhed?virksomhed=A*</pre></a>

    <p>Find alle adresser i kommuner som begynder med "a", på vejkoder som ender på 4, i postnumre som begynder med 6</p>
    <a th:href="@{/services/search/virksomhed?kommune=a*&amp;vej=*4&amp;post=6*}"><pre>/services/search/virksomhed?kommune=a*&amp;vej=*4&amp;post=6*</pre></a>

</div>

</body>
</html>